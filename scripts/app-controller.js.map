{"version":3,"sources":["scripts/app-controller.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","PushClient","stateChangeCb","subscriptionUpdate","_this","this","_stateChangeCb","_subscriptionUpdate","_state","UNSUPPORTED","id","interactive","pushEnabled","INITIALISING","PERMISSION_DENIED","PERMISSION_GRANTED","PERMISSION_PROMPT","ERROR","STARTING_SUBSCRIBE","SUBSCRIBED","STARTING_UNSUBSCRIBE","UNSUBSCRIBED","navigator","window","ServiceWorkerRegistration","serviceWorker","ready","then","setUpPushPermission","value","permissionState","console","error","_this2","_permissionStateChange","Notification","permission","serviceWorkerRegistration","pushManager","getSubscription","subscription","err","log","_this3","subscribe","userVisibleOnly","subscriptionErr","_this4","pushSubscription","unsubscribe","successful","HMAC","ikm","_ikm","input","crypto","subtle","importKey","name","hash","sign","gauntface","HKDF","salt","_salt","_hmac","info","byteLength","fullInfoBuffer","Uint8Array","set","fill","prk","nextHmac","nextPrk","slice","PRIVATE_KEY_BYTES","PUBLIC_KEY_BYTES","SALT_BYTES","joinUnit8Arrays","allUint8Arrays","reduce","cumulativeValue","nextValue","joinedArray","EncryptionHelper","serverKeys","publicKey","privateKey","_serverKeys","publicKeyString","_this5","Promise","resolve","stringKeysToCryptoKeys","keys","CryptoKey","algorithm","namedCurve","public","deriveBits","getPrivateServerKey","_this6","exportCryptoKeys","clientPublicKey","getPublicServerKey","serverPublicKey","utf8Encoder","TextEncoder","labelUnit8Array","encode","paddingUnit8Array","clientPublicKeyLengthUnit8Array","serverPublicKeyLengthBuffer","_this7","contentEncoding8Array","generateContext","contextBuffer","_this8","getSharedSecret","p256dh","sharedSecret","authInfoUint8Array","hkdf","base64UrlToUint8Array","auth","generate","_this9","all","generatePRK","generateCEKInfo","generateNonceInfo","results","cekInfo","nonceInfo","cekHKDF","nonceHKDF","contentEncryptionKey","nonce","payload","_this10","generateEncryptionKeys","encryptionKeys","contentEncryptionCryptoKey","paddingBytes","payloadUint8Array","recordUint8Array","tagLength","iv","encrypt","encryptedPayloadArrayBuffer","cipherText","uint8ArrayToBase64Url","getSalt","publicServerKey","promises","push","exportKey","jwk","x","y","d","exportedKeys","result","publicKeyUnitArray","publicBuffer","kty","crv","ext","keyPromises","privateKeyArray","keyPair","uint8Array","start","end","base64","btoa","String","fromCharCode","apply","replace","base64UrlData","padding","repeat","rawData","atob","buffer","charCodeAt","EncryptionHelperFactory","options","importKeys","generateKeys","getRandomValues","reject","generateKey","AppController","_this11","_PUSH_SERVER_URL","_API_KEY","_sendPushOptions","document","querySelector","_payloadTextField","_stateMsg","oninput","updateCurlCommand","updateXHRButton","updateOrMessage","toggleSwitch","classList","contains","_uiInitialised","MaterialSwitch","mdlUpgradeCb","removeEventListener","addEventListener","_this12","_stateChangeListener","bind","_toggleSwitch","_pushClient","event","checked","subscribeDevice","unsubscribeDevice","sendPushViaXHRButton","_currentSubscription","sendPushMessage","_this13","register","showErrorMessage","state","data","enable","disable","on","off","_this14","style","opacity","payloadTextfieldContainer","subscriptionObject","JSON","parse","stringify","remove","add","_this15","payloadText","payloadPromise","trim","generateHelper","encryptionHelper","encryptMessage","encryptedPayload","curlContainer","curlCommand","endpoint","indexOf","produceGCMProprietaryCURLCommand","display","textContent","produceWebPushProtocolCURLCommand","curlCodeElement","innerHTML","buttonContainer","orMessage","orDisplay","_this16","useGCMProtocol","useWebPushProtocol","arrayBuffer","partialBuffer","_this17","headers","Headers","append","endpointSections","split","subscriptionId","msgBody","registration_ids","raw_data","toBase64","fetch","method","body","response","type","json","responseObj","failure","_this18","fetchOptions","status","additionalHeaders","additionalBody","curlEndpoint","title","message","errorContainer","titleElement","messageElement","pushOptionsContainer"],"mappings":"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","file":"scripts/app-controller.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\n/* eslint-env browser */\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar PushClient = function () {\n  function PushClient(stateChangeCb, subscriptionUpdate) {\n    var _this = this;\n\n    _classCallCheck(this, PushClient);\n\n    this._stateChangeCb = stateChangeCb;\n    this._subscriptionUpdate = subscriptionUpdate;\n\n    this._state = {\n      UNSUPPORTED: {\n        id: 'UNSUPPORTED',\n        interactive: false,\n        pushEnabled: false\n      },\n      INITIALISING: {\n        id: 'INITIALISING',\n        interactive: false,\n        pushEnabled: false\n      },\n      PERMISSION_DENIED: {\n        id: 'PERMISSION_DENIED',\n        interactive: false,\n        pushEnabled: false\n      },\n      PERMISSION_GRANTED: {\n        id: 'PERMISSION_GRANTED',\n        interactive: true\n      },\n      PERMISSION_PROMPT: {\n        id: 'PERMISSION_PROMPT',\n        interactive: true,\n        pushEnabled: false\n      },\n      ERROR: {\n        id: 'ERROR',\n        interactive: false,\n        pushEnabled: false\n      },\n      STARTING_SUBSCRIBE: {\n        id: 'STARTING_SUBSCRIBE',\n        interactive: false,\n        pushEnabled: true\n      },\n      SUBSCRIBED: {\n        id: 'SUBSCRIBED',\n        interactive: true,\n        pushEnabled: true\n      },\n      STARTING_UNSUBSCRIBE: {\n        id: 'STARTING_UNSUBSCRIBE',\n        interactive: false,\n        pushEnabled: false\n      },\n      UNSUBSCRIBED: {\n        id: 'UNSUBSCRIBED',\n        interactive: true,\n        pushEnabled: false\n      }\n    };\n\n    if (!('serviceWorker' in navigator)) {\n      this._stateChangeCb(this._state.UNSUPPORTED);\n      return;\n    }\n\n    if (!('PushManager' in window)) {\n      this._stateChangeCb(this._state.UNSUPPORTED);\n      return;\n    }\n\n    if (!('showNotification' in ServiceWorkerRegistration.prototype)) {\n      this._stateChangeCb(this._state.UNSUPPORTED);\n      return;\n    }\n\n    navigator.serviceWorker.ready.then(function () {\n      _this._stateChangeCb(_this._state.INITIALISING);\n      _this.setUpPushPermission();\n    });\n  }\n\n  _createClass(PushClient, [{\n    key: '_permissionStateChange',\n    value: function _permissionStateChange(permissionState) {\n      // If the notification permission is denied, it's a permanent block\n      switch (permissionState) {\n        case 'denied':\n          this._stateChangeCb(this._state.PERMISSION_DENIED);\n          break;\n        case 'granted':\n          this._stateChangeCb(this._state.PERMISSION_GRANTED);\n          break;\n        case 'default':\n          this._stateChangeCb(this._state.PERMISSION_PROMPT);\n          break;\n        default:\n          console.error('Unexpected permission state: ', permissionState);\n          break;\n      }\n    }\n  }, {\n    key: 'setUpPushPermission',\n    value: function setUpPushPermission() {\n      var _this2 = this;\n\n      this._permissionStateChange(Notification.permission);\n\n      return navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {\n        // Let's see if we have a subscription already\n        return serviceWorkerRegistration.pushManager.getSubscription();\n      }).then(function (subscription) {\n        if (!subscription) {\n          // NOOP since we have no subscription and the permission state\n          // will inform whether to enable or disable the push UI\n          return;\n        }\n\n        _this2._stateChangeCb(_this2._state.SUBSCRIBED);\n\n        // Update the current state with the\n        // subscriptionid and endpoint\n        _this2._subscriptionUpdate(subscription);\n      }).catch(function (err) {\n        console.log(err);\n        _this2._stateChangeCb(_this2._state.ERROR, err);\n      });\n    }\n  }, {\n    key: 'subscribeDevice',\n    value: function subscribeDevice() {\n      var _this3 = this;\n\n      this._stateChangeCb(this._state.STARTING_SUBSCRIBE);\n\n      // We need the service worker registration to access the push manager\n      navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {\n        return serviceWorkerRegistration.pushManager.subscribe({ userVisibleOnly: true });\n      }).then(function (subscription) {\n        _this3._stateChangeCb(_this3._state.SUBSCRIBED);\n        _this3._subscriptionUpdate(subscription);\n      }).catch(function (subscriptionErr) {\n        // Check for a permission prompt issue\n        _this3._permissionStateChange(Notification.permission);\n\n        if (Notification.permission !== 'denied' && Notification.permission !== 'default') {\n          // If the permission wasnt denied or prompt, that means the\n          // permission was accepted, so this must be an error\n          _this3._stateChangeCb(_this3._state.ERROR, subscriptionErr);\n        }\n      });\n    }\n  }, {\n    key: 'unsubscribeDevice',\n    value: function unsubscribeDevice() {\n      var _this4 = this;\n\n      // Disable the switch so it can't be changed while\n      // we process permissions\n      // window.PushDemo.ui.setPushSwitchDisabled(true);\n\n      this._stateChangeCb(this._state.STARTING_UNSUBSCRIBE);\n\n      navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {\n        return serviceWorkerRegistration.pushManager.getSubscription();\n      }).then(function (pushSubscription) {\n        // Check we have everything we need to unsubscribe\n        if (!pushSubscription) {\n          _this4._stateChangeCb(_this4._state.UNSUBSCRIBED);\n          _this4._subscriptionUpdate(null);\n          return;\n        }\n\n        // TODO: Remove the device details from the server\n        // i.e. the pushSubscription.subscriptionId and\n        // pushSubscription.endpoint\n        return pushSubscription.unsubscribe().then(function (successful) {\n          if (!successful) {\n            // The unsubscribe was unsuccessful, but we can\n            // remove the subscriptionId from our server\n            // and notifications will stop\n            // This just may be in a bad state when the user returns\n            console.error('We were unable to unregister from push');\n          }\n        });\n      }).then(function () {\n        _this4._stateChangeCb(_this4._state.UNSUBSCRIBED);\n        _this4._subscriptionUpdate(null);\n      }).catch(function (err) {\n        console.error('Error thrown while revoking push notifications. ' + 'Most likely because push was never registered', err);\n      });\n    }\n  }]);\n\n  return PushClient;\n}();\n\nvar HMAC = function () {\n  function HMAC(ikm) {\n    _classCallCheck(this, HMAC);\n\n    this._ikm = ikm;\n  }\n\n  _createClass(HMAC, [{\n    key: 'sign',\n    value: function sign(input) {\n      return crypto.subtle.importKey('raw', this._ikm, { name: 'HMAC', hash: 'SHA-256' }, false, ['sign']).then(function (key) {\n        return crypto.subtle.sign('HMAC', key, input);\n      });\n    }\n  }]);\n\n  return HMAC;\n}();\n\nif (typeof window !== 'undefined') {\n  window.gauntface = window.gauntface || {};\n  window.gauntface.HMAC = HMAC;\n}\n\nvar HKDF = function () {\n  function HKDF(ikm, salt) {\n    _classCallCheck(this, HKDF);\n\n    this._ikm = ikm;\n    this._salt = salt;\n\n    this._hmac = new HMAC(salt);\n  }\n\n  _createClass(HKDF, [{\n    key: 'generate',\n    value: function generate(info, byteLength) {\n      var fullInfoBuffer = new Uint8Array(info.byteLength + 1);\n      fullInfoBuffer.set(info, 0);\n      fullInfoBuffer.set(new Uint8Array(1).fill(1), info.byteLength);\n\n      return this._hmac.sign(this._ikm).then(function (prk) {\n        var nextHmac = new HMAC(prk);\n        return nextHmac.sign(fullInfoBuffer);\n      }).then(function (nextPrk) {\n        return nextPrk.slice(0, byteLength);\n      });\n    }\n  }]);\n\n  return HKDF;\n}();\n\nif (typeof window !== 'undefined') {\n  window.gauntface = window.gauntface || {};\n  window.gauntface.HKDF = HKDF;\n}\n\n// Length, in bytes, of a P-256 field element. Expected format of the private key.\nvar PRIVATE_KEY_BYTES = 32;\n\n// Length, in bytes, of a P-256 public key in uncompressed EC form per SEC 2.3.3. This sequence must\n// start with 0x04. Expected format of the public key.\nvar PUBLIC_KEY_BYTES = 65;\n\n// Length, in bytes, of the salt that should be used for the message.\nvar SALT_BYTES = 16;\n\nvar joinUnit8Arrays = function joinUnit8Arrays(allUint8Arrays) {\n  // Super inefficient. But easier to follow than allocating the\n  // array with the correct size and position values in that array\n  // as required.\n  return allUint8Arrays.reduce(function (cumulativeValue, nextValue) {\n    var joinedArray = new Uint8Array(cumulativeValue.byteLength + nextValue.byteLength);\n    joinedArray.set(cumulativeValue, 0);\n    joinedArray.set(nextValue, cumulativeValue.byteLength);\n    return joinedArray;\n  }, new Uint8Array());\n};\n\nvar EncryptionHelper = function () {\n  function EncryptionHelper(serverKeys, salt) {\n    _classCallCheck(this, EncryptionHelper);\n\n    if (!serverKeys || !serverKeys.publicKey || !serverKeys.privateKey) {\n      throw new Error('Bad server keys. Use ' + 'EncryptionHelperFactory.generateKeys()');\n    }\n\n    if (!salt) {\n      throw new Error('Bad salt value. Use ' + 'EncryptionHelperFactory.generateSalt()');\n    }\n\n    this._serverKeys = serverKeys;\n    this._salt = salt;\n  }\n\n  _createClass(EncryptionHelper, [{\n    key: 'getPublicServerKey',\n    value: function getPublicServerKey() {\n      return this._serverKeys.publicKey;\n    }\n  }, {\n    key: 'getPrivateServerKey',\n    value: function getPrivateServerKey() {\n      return this._serverKeys.privateKey;\n    }\n  }, {\n    key: 'getSharedSecret',\n    value: function getSharedSecret(publicKeyString) {\n      var _this5 = this;\n\n      return Promise.resolve().then(function () {\n        return EncryptionHelper.stringKeysToCryptoKeys(publicKeyString);\n      }).then(function (keys) {\n        return keys.publicKey;\n      }).then(function (publicKey) {\n        if (!(publicKey instanceof CryptoKey)) {\n          throw new Error('The publicKey must be a CryptoKey.');\n        }\n\n        var algorithm = {\n          name: 'ECDH',\n          namedCurve: 'P-256',\n          public: publicKey\n        };\n\n        return crypto.subtle.deriveBits(algorithm, _this5.getPrivateServerKey(), 256);\n      });\n    }\n  }, {\n    key: 'getSalt',\n    value: function getSalt() {\n      return this._salt;\n    }\n  }, {\n    key: 'generateContext',\n    value: function generateContext(publicKeyString) {\n      var _this6 = this;\n\n      return Promise.resolve().then(function () {\n        return EncryptionHelper.stringKeysToCryptoKeys(publicKeyString);\n      }).then(function (keys) {\n        return EncryptionHelper.exportCryptoKeys(keys.publicKey).then(function (keys) {\n          return keys.publicKey;\n        });\n      }).then(function (clientPublicKey) {\n        return EncryptionHelper.exportCryptoKeys(_this6.getPublicServerKey()).then(function (keys) {\n          return {\n            clientPublicKey: clientPublicKey,\n            serverPublicKey: keys.publicKey\n          };\n        });\n      }).then(function (keys) {\n        var utf8Encoder = new TextEncoder('utf-8');\n        var labelUnit8Array = utf8Encoder.encode('P-256');\n        var paddingUnit8Array = new Uint8Array(1).fill(0);\n\n        var clientPublicKeyLengthUnit8Array = new Uint8Array(2);\n        clientPublicKeyLengthUnit8Array[0] = 0x00;\n        clientPublicKeyLengthUnit8Array[1] = keys.clientPublicKey.byteLength;\n\n        var serverPublicKeyLengthBuffer = new Uint8Array(2);\n        serverPublicKeyLengthBuffer[0] = 0x00;\n        serverPublicKeyLengthBuffer[1] = keys.serverPublicKey.byteLength;\n\n        return joinUnit8Arrays([labelUnit8Array, paddingUnit8Array, clientPublicKeyLengthUnit8Array, keys.clientPublicKey, serverPublicKeyLengthBuffer, keys.serverPublicKey]);\n      });\n    }\n  }, {\n    key: 'generateCEKInfo',\n    value: function generateCEKInfo(publicKeyString) {\n      var _this7 = this;\n\n      return Promise.resolve().then(function () {\n        var utf8Encoder = new TextEncoder('utf-8');\n        var contentEncoding8Array = utf8Encoder.encode('Content-Encoding: aesgcm');\n        var paddingUnit8Array = new Uint8Array(1).fill(0);\n        return _this7.generateContext(publicKeyString).then(function (contextBuffer) {\n          return joinUnit8Arrays([contentEncoding8Array, paddingUnit8Array, contextBuffer]);\n        });\n      });\n    }\n  }, {\n    key: 'generateNonceInfo',\n    value: function generateNonceInfo(publicKeyString) {\n      var _this8 = this;\n\n      return Promise.resolve().then(function () {\n        var utf8Encoder = new TextEncoder('utf-8');\n        var contentEncoding8Array = utf8Encoder.encode('Content-Encoding: nonce');\n        var paddingUnit8Array = new Uint8Array(1).fill(0);\n        return _this8.generateContext(publicKeyString).then(function (contextBuffer) {\n          return joinUnit8Arrays([contentEncoding8Array, paddingUnit8Array, contextBuffer]);\n        });\n      });\n    }\n  }, {\n    key: 'generatePRK',\n    value: function generatePRK(subscription) {\n      return this.getSharedSecret(subscription.keys.p256dh).then(function (sharedSecret) {\n        var utf8Encoder = new TextEncoder('utf-8');\n        var authInfoUint8Array = utf8Encoder.encode('Content-Encoding: auth\\0');\n\n        var hkdf = new HKDF(sharedSecret, EncryptionHelper.base64UrlToUint8Array(subscription.keys.auth));\n        return hkdf.generate(authInfoUint8Array, 32);\n      });\n    }\n  }, {\n    key: 'generateEncryptionKeys',\n    value: function generateEncryptionKeys(subscription) {\n      var _this9 = this;\n\n      return Promise.all([this.generatePRK(subscription), this.generateCEKInfo(subscription.keys.p256dh), this.generateNonceInfo(subscription.keys.p256dh)]).then(function (results) {\n        var prk = results[0];\n        var cekInfo = results[1];\n        var nonceInfo = results[2];\n\n        var cekHKDF = new HKDF(prk, _this9._salt);\n        var nonceHKDF = new HKDF(prk, _this9._salt);\n        return Promise.all([cekHKDF.generate(cekInfo, 16), nonceHKDF.generate(nonceInfo, 12)]);\n      }).then(function (results) {\n        return {\n          contentEncryptionKey: results[0],\n          nonce: results[1]\n        };\n      });\n    }\n  }, {\n    key: 'encryptMessage',\n    value: function encryptMessage(subscription, payload) {\n      var _this10 = this;\n\n      return this.generateEncryptionKeys(subscription).then(function (encryptionKeys) {\n        return crypto.subtle.importKey('raw', encryptionKeys.contentEncryptionKey, 'AES-GCM', true, ['decrypt', 'encrypt']).then(function (contentEncryptionCryptoKey) {\n          encryptionKeys.contentEncryptionCryptoKey = contentEncryptionCryptoKey;\n          return encryptionKeys;\n        });\n      }).then(function (encryptionKeys) {\n        var paddingBytes = 0;\n        var paddingUnit8Array = new Uint8Array(2 + paddingBytes);\n        var utf8Encoder = new TextEncoder('utf-8');\n        var payloadUint8Array = utf8Encoder.encode(payload);\n        var recordUint8Array = new Uint8Array(paddingUnit8Array.byteLength + payloadUint8Array.byteLength);\n        recordUint8Array.set(paddingUnit8Array, 0);\n        recordUint8Array.set(payloadUint8Array, paddingUnit8Array.byteLength);\n\n        var algorithm = {\n          name: 'AES-GCM',\n          tagLength: 128,\n          iv: encryptionKeys.nonce\n        };\n\n        return crypto.subtle.encrypt(algorithm, encryptionKeys.contentEncryptionCryptoKey, recordUint8Array);\n      }).then(function (encryptedPayloadArrayBuffer) {\n        return EncryptionHelper.exportCryptoKeys(_this10.getPublicServerKey()).then(function (keys) {\n          return {\n            cipherText: encryptedPayloadArrayBuffer,\n            salt: EncryptionHelper.uint8ArrayToBase64Url(_this10.getSalt()),\n            publicServerKey: EncryptionHelper.uint8ArrayToBase64Url(keys.publicKey)\n          };\n        });\n      });\n    }\n  }], [{\n    key: 'exportCryptoKeys',\n    value: function exportCryptoKeys(publicKey, privateKey) {\n      return Promise.resolve().then(function () {\n        var promises = [];\n        promises.push(crypto.subtle.exportKey('jwk', publicKey).then(function (jwk) {\n          var x = EncryptionHelper.base64UrlToUint8Array(jwk.x);\n          var y = EncryptionHelper.base64UrlToUint8Array(jwk.y);\n\n          var publicKey = new Uint8Array(65);\n          publicKey.set([0x04], 0);\n          publicKey.set(x, 1);\n          publicKey.set(y, 33);\n\n          return publicKey;\n        }));\n\n        if (privateKey) {\n          promises.push(crypto.subtle.exportKey('jwk', privateKey).then(function (jwk) {\n            return EncryptionHelper.base64UrlToUint8Array(jwk.d);\n          }));\n        }\n\n        return Promise.all(promises);\n      }).then(function (exportedKeys) {\n        var result = {\n          publicKey: exportedKeys[0]\n        };\n\n        if (exportedKeys.length > 1) {\n          result.privateKey = exportedKeys[1];\n        }\n\n        return result;\n      });\n    }\n  }, {\n    key: 'stringKeysToCryptoKeys',\n    value: function stringKeysToCryptoKeys(publicKey, privateKey) {\n      if (!(typeof publicKey === 'string')) {\n        throw new Error('The publicKey is expected to be an String.');\n      }\n\n      var publicKeyUnitArray = EncryptionHelper.base64UrlToUint8Array(publicKey);\n      if (publicKeyUnitArray.byteLength !== PUBLIC_KEY_BYTES) {\n        throw new Error('The publicKey is expected to be ' + PUBLIC_KEY_BYTES + ' bytes.');\n      }\n\n      var publicBuffer = new Uint8Array(publicKeyUnitArray);\n      if (publicBuffer[0] !== 0x04) {\n        throw new Error('The publicKey is expected to start with an ' + '0x04 byte.');\n      }\n\n      var jwk = {\n        kty: 'EC',\n        crv: 'P-256',\n        x: EncryptionHelper.uint8ArrayToBase64Url(publicBuffer, 1, 33),\n        y: EncryptionHelper.uint8ArrayToBase64Url(publicBuffer, 33, 65),\n        ext: true\n      };\n\n      var keyPromises = [];\n      keyPromises.push(crypto.subtle.importKey('jwk', jwk, { name: 'ECDH', namedCurve: 'P-256' }, true, []));\n\n      if (privateKey) {\n        if (!(typeof privateKey === 'string')) {\n          throw new Error('The privateKey is expected to be an String.');\n        }\n\n        var privateKeyArray = EncryptionHelper.base64UrlToUint8Array(privateKey);\n\n        if (privateKeyArray.byteLength !== PRIVATE_KEY_BYTES) {\n          throw new Error('The privateKey is expected to be ' + PRIVATE_KEY_BYTES + ' bytes.');\n        }\n\n        // d must be defined after the importKey call for public\n        jwk.d = EncryptionHelper.uint8ArrayToBase64Url(new Uint8Array(privateKeyArray));\n        keyPromises.push(crypto.subtle.importKey('jwk', jwk, { name: 'ECDH', namedCurve: 'P-256' }, true, ['deriveBits']));\n      }\n\n      return Promise.all(keyPromises).then(function (keys) {\n        var keyPair = {\n          publicKey: keys[0]\n        };\n        if (keys.length > 1) {\n          keyPair.privateKey = keys[1];\n        }\n        return keyPair;\n      });\n    }\n  }, {\n    key: 'uint8ArrayToBase64Url',\n    value: function uint8ArrayToBase64Url(uint8Array, start, end) {\n      start = start || 0;\n      end = end || uint8Array.byteLength;\n\n      var base64 = btoa(String.fromCharCode.apply(null, uint8Array.slice(start, end)));\n      return base64.replace(/\\=/g, '') // eslint-disable-line no-useless-escape\n      .replace(/\\+/g, '-').replace(/\\//g, '_');\n    }\n\n    // Converts the URL-safe base64 encoded |base64UrlData| to an Uint8Array buffer.\n\n  }, {\n    key: 'base64UrlToUint8Array',\n    value: function base64UrlToUint8Array(base64UrlData) {\n      var padding = '='.repeat((4 - base64UrlData.length % 4) % 4);\n      var base64 = (base64UrlData + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n\n      var rawData = atob(base64);\n      var buffer = new Uint8Array(rawData.length);\n\n      for (var i = 0; i < rawData.length; ++i) {\n        buffer[i] = rawData.charCodeAt(i);\n      }\n      return buffer;\n    }\n  }]);\n\n  return EncryptionHelper;\n}();\n\nvar EncryptionHelperFactory = function () {\n  function EncryptionHelperFactory() {\n    _classCallCheck(this, EncryptionHelperFactory);\n  }\n\n  _createClass(EncryptionHelperFactory, null, [{\n    key: 'generateHelper',\n    value: function generateHelper(options) {\n      return Promise.resolve().then(function () {\n        if (options && options.serverKeys) {\n          return EncryptionHelperFactory.importKeys(options);\n        }\n\n        return EncryptionHelperFactory.generateKeys(options);\n      }).then(function (keys) {\n        var salt = null;\n        if (options && options.salt) {\n          salt = EncryptionHelper.base64UrlToUint8Array(options.salt);\n        } else {\n          salt = crypto.getRandomValues(new Uint8Array(16));\n        }\n        return new EncryptionHelper(keys, salt);\n      });\n    }\n  }, {\n    key: 'importKeys',\n    value: function importKeys(options) {\n      if (!options || !options.serverKeys || !options.serverKeys.publicKey || !options.serverKeys.privateKey) {\n        return Promise.reject(new Error('Bad options for key import'));\n      }\n\n      return Promise.resolve().then(function () {\n        return EncryptionHelper.stringKeysToCryptoKeys(options.serverKeys.publicKey, options.serverKeys.privateKey);\n      });\n    }\n  }, {\n    key: 'generateKeys',\n    value: function generateKeys() {\n      // True is to make the keys extractable\n      return crypto.subtle.generateKey({ name: 'ECDH', namedCurve: 'P-256' }, true, ['deriveBits']);\n    }\n  }, {\n    key: 'generateSalt',\n    value: function generateSalt() {\n      return crypto.getRandomValues(new Uint8Array(SALT_BYTES));\n    }\n  }]);\n\n  return EncryptionHelperFactory;\n}();\n\nif (typeof window !== 'undefined') {\n  window.gauntface = window.gauntface || {};\n  window.gauntface.EncryptionHelperFactory = EncryptionHelperFactory;\n  window.gauntface.EncryptionHelper = EncryptionHelper;\n}\n\nvar AppController = function () {\n  function AppController() {\n    var _this11 = this;\n\n    _classCallCheck(this, AppController);\n\n    // Define a different server URL here if desire.\n    this._PUSH_SERVER_URL = '';\n    this._API_KEY = 'AIzaSyBBh4ddPa96rQQNxqiq_qQj7sq1JdsNQUQ';\n\n    // This div contains the UI for CURL commands to trigger a push\n    this._sendPushOptions = document.querySelector('.js-send-push-options');\n    this._payloadTextField = document.querySelector('.js-payload-textfield');\n    this._stateMsg = document.querySelector('.js-state-msg');\n    this._payloadTextField.oninput = function () {\n      Promise.all([_this11.updateCurlCommand(), _this11.updateXHRButton()]).then(function () {\n        _this11.updateOrMessage();\n      });\n    };\n\n    // Below this comment is code to initialise a material design lite view.\n    var toggleSwitch = document.querySelector('.js-push-toggle-switch');\n    if (toggleSwitch.classList.contains('is-upgraded')) {\n      this.ready = Promise.resolve();\n      this._uiInitialised(toggleSwitch.MaterialSwitch);\n    } else {\n      this.ready = new Promise(function (resolve) {\n        var mdlUpgradeCb = function mdlUpgradeCb() {\n          if (!toggleSwitch.classList.contains('is-upgraded')) {\n            return;\n          }\n\n          _this11._uiInitialised(toggleSwitch.MaterialSwitch);\n          document.removeEventListener(mdlUpgradeCb);\n\n          resolve();\n        };\n\n        // This is to wait for MDL initialising\n        document.addEventListener('mdl-componentupgraded', mdlUpgradeCb);\n      });\n    }\n  }\n\n  _createClass(AppController, [{\n    key: '_uiInitialised',\n    value: function _uiInitialised(toggleSwitch) {\n      var _this12 = this;\n\n      this._stateChangeListener = this._stateChangeListener.bind(this);\n      this._subscriptionUpdate = this._subscriptionUpdate.bind(this);\n\n      this._toggleSwitch = toggleSwitch;\n      this._pushClient = new PushClient(this._stateChangeListener, this._subscriptionUpdate);\n\n      document.querySelector('.js-push-toggle-switch > input').addEventListener('click', function (event) {\n        // Inverted because clicking will change the checked state by\n        // the time we get here\n        if (event.target.checked) {\n          _this12._pushClient.subscribeDevice();\n        } else {\n          _this12._pushClient.unsubscribeDevice();\n        }\n      });\n\n      var sendPushViaXHRButton = document.querySelector('.js-send-push-button');\n      sendPushViaXHRButton.addEventListener('click', function () {\n        if (_this12._currentSubscription) {\n          _this12.sendPushMessage(_this12._currentSubscription, _this12._payloadTextField.value);\n        }\n      });\n    }\n  }, {\n    key: 'registerServiceWorker',\n    value: function registerServiceWorker() {\n      var _this13 = this;\n\n      // Check that service workers are supported\n      if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.register('./service-worker.js').catch(function (err) {\n          _this13.showErrorMessage('Unable to Register SW', 'Sorry this demo requires a service worker to work and it ' + 'was didn\\'t seem to install - sorry :(');\n          console.error(err);\n        });\n      } else {\n        this.showErrorMessage('Service Worker Not Supported', 'Sorry this demo requires service worker support in your browser. ' + 'Please try this demo in Chrome or Firefox Nightly.');\n      }\n    }\n  }, {\n    key: '_stateChangeListener',\n    value: function _stateChangeListener(state, data) {\n      // console.log(state);\n      if (typeof state.interactive !== 'undefined') {\n        if (state.interactive) {\n          this._toggleSwitch.enable();\n        } else {\n          this._toggleSwitch.disable();\n        }\n      }\n\n      if (typeof state.pushEnabled !== 'undefined') {\n        if (state.pushEnabled) {\n          this._toggleSwitch.on();\n        } else {\n          this._toggleSwitch.off();\n        }\n      }\n\n      switch (state.id) {\n        case 'ERROR':\n          this.showErrorMessage('Ooops a Problem Occurred', data);\n          break;\n        default:\n          break;\n      }\n    }\n  }, {\n    key: '_subscriptionUpdate',\n    value: function _subscriptionUpdate(subscription) {\n      var _this14 = this;\n\n      this._currentSubscription = subscription;\n\n      if (!subscription) {\n        // Remove any subscription from your servers if you have\n        // set it up.\n        this._sendPushOptions.style.opacity = 0;\n        return;\n      }\n\n      // This is too handle old versions of Firefox where keys would exist\n      // but auth wouldn't\n      var payloadTextfieldContainer = document.querySelector('.js-payload-textfield-container');\n      var subscriptionObject = JSON.parse(JSON.stringify(subscription));\n      if (subscriptionObject && subscriptionObject.keys && subscriptionObject.keys.auth && subscriptionObject.keys.p256dh) {\n        payloadTextfieldContainer.classList.remove('hidden');\n      } else {\n        payloadTextfieldContainer.classList.add('hidden');\n      }\n\n      Promise.all([this.updateCurlCommand(), this.updateXHRButton()]).then(function () {\n        _this14.updateOrMessage();\n      });\n\n      // Display the UI\n      this._sendPushOptions.style.opacity = 1;\n    }\n  }, {\n    key: 'updateCurlCommand',\n    value: function updateCurlCommand() {\n      var _this15 = this;\n\n      var payloadText = this._payloadTextField.value;\n      var payloadPromise = Promise.resolve(null);\n      if (payloadText && payloadText.trim().length > 0) {\n        payloadPromise = EncryptionHelperFactory.generateHelper().then(function (encryptionHelper) {\n          return encryptionHelper.encryptMessage(JSON.parse(JSON.stringify(_this15._currentSubscription)), payloadText);\n        });\n      }\n\n      return payloadPromise.then(function (encryptedPayload) {\n        var curlContainer = document.querySelector('.js-curl-container');\n        var curlCommand = void 0;\n\n        // GCM Command\n        if (_this15._currentSubscription.endpoint.indexOf('https://android.googleapis.com/gcm/send') === 0) {\n          curlCommand = _this15.produceGCMProprietaryCURLCommand(_this15._currentSubscription, encryptedPayload);\n\n          // Web Push Protocol\n        } else if (payloadText && payloadText.trim().length > 0) {\n            // Turn off curl command\n            curlContainer.style.display = 'none';\n            _this15._stateMsg.textContent = 'Note: Push messages with a payload ' + 'can\\'t be sent with a cURL command due to the body of the web ' + 'push protocol request being a stream.';\n            return;\n          } else {\n            _this15._stateMsg.textContent = '';\n            curlCommand = _this15.produceWebPushProtocolCURLCommand(_this15._currentSubscription, encryptedPayload);\n          }\n\n        curlContainer.style.display = 'block';\n        var curlCodeElement = document.querySelector('.js-curl-code');\n        curlCodeElement.innerHTML = curlCommand;\n      });\n    }\n  }, {\n    key: 'updateXHRButton',\n    value: function updateXHRButton() {\n      var buttonContainer = document.querySelector('.js-xhr-button-container');\n      if (this._currentSubscription.endpoint.indexOf('https://android.googleapis.com/gcm/send') === 0 && this._payloadTextField.value.trim().length > 0) {\n        buttonContainer.style.display = 'none';\n        return;\n      }\n\n      buttonContainer.style.display = 'block';\n    }\n  }, {\n    key: 'updateOrMessage',\n    value: function updateOrMessage() {\n      var orMessage = document.querySelector('.js-push-options-or');\n      var buttonContainer = document.querySelector('.js-xhr-button-container');\n      var curlContainer = document.querySelector('.js-curl-container');\n\n      var orDisplay = buttonContainer.style.display === 'none' || curlContainer.style.display === 'none' ? 'none' : 'block';\n\n      orMessage.style.display = orDisplay;\n    }\n  }, {\n    key: 'sendPushMessage',\n    value: function sendPushMessage(subscription, payloadText) {\n      var _this16 = this;\n\n      var payloadPromise = Promise.resolve(null);\n      if (payloadText && payloadText.trim().length > 0) {\n        payloadPromise = EncryptionHelperFactory.generateHelper().then(function (encryptionHelper) {\n          console.log(JSON.stringify(subscription));\n          return encryptionHelper.encryptMessage(JSON.parse(JSON.stringify(subscription)), payloadText);\n        });\n      }\n\n      payloadPromise.then(function (encryptedPayload) {\n        if (subscription.endpoint.indexOf('https://android.googleapis.com/gcm/send') === 0) {\n          _this16.useGCMProtocol(subscription, encryptedPayload);\n        } else {\n          _this16.useWebPushProtocol(subscription, encryptedPayload);\n        }\n      });\n    }\n  }, {\n    key: 'toBase64',\n    value: function toBase64(arrayBuffer, start, end) {\n      start = start || 0;\n      end = end || arrayBuffer.byteLength;\n\n      var partialBuffer = new Uint8Array(arrayBuffer.slice(start, end));\n      return btoa(String.fromCharCode.apply(null, partialBuffer));\n    }\n  }, {\n    key: 'useGCMProtocol',\n    value: function useGCMProtocol(subscription, encryptedPayload) {\n      var _this17 = this;\n\n      console.log('Sending XHR to GCM Protocol endpoint');\n\n      var headers = new Headers();\n      headers.append('Content-Type', 'application/json');\n      headers.append('Authorization', 'key=' + this._API_KEY);\n\n      var endpointSections = subscription.endpoint.split('/');\n      var subscriptionId = endpointSections[endpointSections.length - 1];\n      var msgBody = {\n        registration_ids: [subscriptionId] // eslint-disable-line camelcase\n      };\n\n      if (encryptedPayload) {\n        msgBody.raw_data = this.toBase64(encryptedPayload.cipherText); // eslint-disable-line camelcase\n\n        headers.append('Encryption', 'salt=' + encryptedPayload.salt);\n        headers.append('Crypto-Key', 'dh=' + encryptedPayload.publicServerKey);\n        headers.append('Content-Encoding', 'aesgcm');\n      }\n\n      fetch('https://android.googleapis.com/gcm/send', {\n        method: 'post',\n        headers: headers,\n        body: JSON.stringify(msgBody)\n      }).then(function (response) {\n        if (response.type === 'opaque') {\n          return;\n        }\n\n        return response.json().then(function (responseObj) {\n          if (responseObj.failure !== 0) {\n            console.log('Failed GCM response: ', responseObj);\n            throw new Error('Failed to send push message via GCM');\n          }\n        });\n      }).catch(function (err) {\n        _this17.showErrorMessage('Ooops Unable to Send a Push', err);\n      });\n    }\n  }, {\n    key: 'useWebPushProtocol',\n    value: function useWebPushProtocol(subscription, encryptedPayload) {\n      var _this18 = this;\n\n      console.log('Sending XHR to Web Push Protocol endpoint');\n      var headers = new Headers();\n      headers.append('TTL', 60);\n\n      var fetchOptions = {\n        method: 'post',\n        headers: headers\n      };\n\n      if (encryptedPayload) {\n        fetchOptions.body = encryptedPayload.cipherText;\n\n        headers.append('Encryption', 'salt=' + encryptedPayload.salt);\n        headers.append('Crypto-Key', 'dh=' + encryptedPayload.publicServerKey);\n        headers.append('Content-Encoding', 'application/octet-stream');\n        headers.append('Content-Encoding', 'aesgcm');\n      }\n\n      fetch(subscription.endpoint, fetchOptions).then(function (response) {\n        if (response.status >= 400 && response.status < 500) {\n          console.log('Failed web push response: ', response, response.status);\n          throw new Error('Failed to send push message via web push protocol');\n        }\n      }).catch(function (err) {\n        _this18.showErrorMessage('Ooops Unable to Send a Push', err);\n      });\n    }\n  }, {\n    key: 'produceGCMProprietaryCURLCommand',\n    value: function produceGCMProprietaryCURLCommand(subscription, encryptedPayload) {\n      var additionalHeaders = '';\n      var additionalBody = '';\n      if (encryptedPayload) {\n        additionalBody = ', \\\\\"raw_data\\\\\": \\\\\"' + this.toBase64(encryptedPayload.cipherText) + '\\\\\"';\n\n        additionalHeaders += ' --header \"Encryption: salt=' + encryptedPayload.salt + '\"';\n        additionalHeaders += ' --header \"Crypto-Key: dh=' + encryptedPayload.publicServerKey + '\"';\n        additionalHeaders += ' --header \"Content-Encoding: aesgcm\"';\n\n        this._stateMsg.textContent = 'Note: Push messages with a payload ' + 'can\\'t be sent to GCM due to a CORs issue. Trigger a push ' + 'message with the cURL command below.';\n      } else {\n        this._stateMsg.textContent = '';\n      }\n\n      var curlEndpoint = 'https://android.googleapis.com/gcm/send';\n      var endpointSections = subscription.endpoint.split('/');\n      var subscriptionId = endpointSections[endpointSections.length - 1];\n      var curlCommand = 'curl --header \"Authorization: key=' + this._API_KEY + '\" --header \"Content-Type: application/json\"' + additionalHeaders + ' ' + curlEndpoint + ' -d \"{\\\\\"to\\\\\":\\\\\"' + subscriptionId + '\\\\\"' + additionalBody + '}\"';\n      return curlCommand;\n    }\n  }, {\n    key: 'produceWebPushProtocolCURLCommand',\n    value: function produceWebPushProtocolCURLCommand(subscription) {\n      // Payload body is a byte array so can't add to cURL command\n      var curlEndpoint = subscription.endpoint;\n      var curlCommand = 'curl --header \"TTL: 60\" --request POST ' + curlEndpoint;\n      return curlCommand;\n    }\n  }, {\n    key: 'showErrorMessage',\n    value: function showErrorMessage(title, message) {\n      var errorContainer = document.querySelector('.js-error-message-container');\n\n      var titleElement = errorContainer.querySelector('.js-error-title');\n      var messageElement = errorContainer.querySelector('.js-error-message');\n      titleElement.textContent = title;\n      messageElement.innerHTML = message;\n      errorContainer.style.opacity = 1;\n\n      var pushOptionsContainer = document.querySelector('.js-send-push-options');\n      pushOptionsContainer.style.display = 'none';\n    }\n  }]);\n\n  return AppController;\n}();\n\nmodule.exports = AppController;\n\n},{}]},{},[1]);\n"],"sourceRoot":"/source/"}