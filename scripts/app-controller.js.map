{"version":3,"sources":["scripts/app-controller.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","PushClient","stateChangeCb","subscriptionUpdate","_this","this","_stateChangeCb","_subscriptionUpdate","_state","UNSUPPORTED","id","interactive","pushEnabled","INITIALISING","PERMISSION_DENIED","PERMISSION_GRANTED","PERMISSION_PROMPT","ERROR","STARTING_SUBSCRIBE","SUBSCRIBED","STARTING_UNSUBSCRIBE","UNSUBSCRIBED","navigator","window","ServiceWorkerRegistration","serviceWorker","ready","then","setUpPushPermission","value","permissionState","console","error","_this2","_permissionStateChange","Notification","permission","serviceWorkerRegistration","pushManager","getSubscription","subscription","err","log","_this3","subscribe","userVisibleOnly","subscriptionErr","_this4","pushSubscription","unsubscribe","successful","AppController","_this5","_PUSH_SERVER_URL","_API_KEY","_sendPushOptions","document","querySelector","toggleSwitch","classList","contains","Promise","resolve","_uiInitialised","MaterialSwitch","mdlUpgradeCb","removeEventListener","addEventListener","_this6","_stateChangeListener","bind","_toggleSwitch","_pushClient","event","checked","subscribeDevice","unsubscribeDevice","location","protocol","hostname","showErrorMessage","_this7","register","state","data","enable","disable","on","off","_this8","style","opacity","curlCommand","endpoint","indexOf","produceGCMProprietaryCURLCommand","produceWebPushProtocolCURLCommand","curlCodeElement","innerHTML","sendPushViaXHRButton","sendPushMessage","useGCMProtocol","useWebPushProtocol","_this9","headers","Headers","append","endpointSections","split","subscriptionId","fetch","method","body","JSON","stringify","registration_ids","response","json","responseObj","failure","_this10","TTL","status","curlEndpoint","title","message","errorContainer","titleElement","messageElement","textContent","pushOptionsContainer","display"],"mappings":"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","file":"scripts/app-controller.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\n/* eslint-env browser */\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar PushClient = function () {\n  function PushClient(stateChangeCb, subscriptionUpdate) {\n    var _this = this;\n\n    _classCallCheck(this, PushClient);\n\n    this._stateChangeCb = stateChangeCb;\n    this._subscriptionUpdate = subscriptionUpdate;\n\n    this._state = {\n      UNSUPPORTED: {\n        id: 'UNSUPPORTED',\n        interactive: false,\n        pushEnabled: false\n      },\n      INITIALISING: {\n        id: 'INITIALISING',\n        interactive: false,\n        pushEnabled: false\n      },\n      PERMISSION_DENIED: {\n        id: 'PERMISSION_DENIED',\n        interactive: false,\n        pushEnabled: false\n      },\n      PERMISSION_GRANTED: {\n        id: 'PERMISSION_GRANTED',\n        interactive: true\n      },\n      PERMISSION_PROMPT: {\n        id: 'PERMISSION_PROMPT',\n        interactive: true,\n        pushEnabled: false\n      },\n      ERROR: {\n        id: 'ERROR',\n        interactive: false,\n        pushEnabled: false\n      },\n      STARTING_SUBSCRIBE: {\n        id: 'STARTING_SUBSCRIBE',\n        interactive: false,\n        pushEnabled: true\n      },\n      SUBSCRIBED: {\n        id: 'SUBSCRIBED',\n        interactive: true,\n        pushEnabled: true\n      },\n      STARTING_UNSUBSCRIBE: {\n        id: 'STARTING_UNSUBSCRIBE',\n        interactive: false,\n        pushEnabled: false\n      },\n      UNSUBSCRIBED: {\n        id: 'UNSUBSCRIBED',\n        interactive: true,\n        pushEnabled: false\n      }\n    };\n\n    if (!('serviceWorker' in navigator)) {\n      this._stateChangeCb(this._state.UNSUPPORTED);\n      return;\n    }\n\n    if (!('PushManager' in window)) {\n      this._stateChangeCb(this._state.UNSUPPORTED);\n      return;\n    }\n\n    if (!('showNotification' in ServiceWorkerRegistration.prototype)) {\n      this._stateChangeCb(this._state.UNSUPPORTED);\n      return;\n    }\n\n    navigator.serviceWorker.ready.then(function () {\n      _this._stateChangeCb(_this._state.INITIALISING);\n      _this.setUpPushPermission();\n    });\n  }\n\n  _createClass(PushClient, [{\n    key: '_permissionStateChange',\n    value: function _permissionStateChange(permissionState) {\n      // If the notification permission is denied, it's a permanent block\n      switch (permissionState) {\n        case 'denied':\n          this._stateChangeCb(this._state.PERMISSION_DENIED);\n          break;\n        case 'granted':\n          this._stateChangeCb(this._state.PERMISSION_GRANTED);\n          break;\n        case 'default':\n          this._stateChangeCb(this._state.PERMISSION_PROMPT);\n          break;\n        default:\n          console.error('Unexpected permission state: ', permissionState);\n          break;\n      }\n    }\n  }, {\n    key: 'setUpPushPermission',\n    value: function setUpPushPermission() {\n      var _this2 = this;\n\n      this._permissionStateChange(Notification.permission);\n\n      return navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {\n        // Let's see if we have a subscription already\n        return serviceWorkerRegistration.pushManager.getSubscription();\n      }).then(function (subscription) {\n        if (!subscription) {\n          // NOOP since we have no subscription and the permission state\n          // will inform whether to enable or disable the push UI\n          return;\n        }\n\n        _this2._stateChangeCb(_this2._state.SUBSCRIBED);\n\n        // Update the current state with the\n        // subscriptionid and endpoint\n        _this2._subscriptionUpdate(subscription);\n      }).catch(function (err) {\n        console.log(err);\n        _this2._stateChangeCb(_this2._state.ERROR, err);\n      });\n    }\n  }, {\n    key: 'subscribeDevice',\n    value: function subscribeDevice() {\n      var _this3 = this;\n\n      this._stateChangeCb(this._state.STARTING_SUBSCRIBE);\n\n      // We need the service worker registration to access the push manager\n      navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {\n        return serviceWorkerRegistration.pushManager.subscribe({ userVisibleOnly: true });\n      }).then(function (subscription) {\n        _this3._stateChangeCb(_this3._state.SUBSCRIBED);\n        _this3._subscriptionUpdate(subscription);\n      }).catch(function (subscriptionErr) {\n        // Check for a permission prompt issue\n        _this3._permissionStateChange(Notification.permission);\n\n        if (Notification.permission !== 'denied' && Notification.permission !== 'default') {\n          // If the permission wasnt denied or prompt, that means the\n          // permission was accepted, so this must be an error\n          _this3._stateChangeCb(_this3._state.ERROR, subscriptionErr);\n        }\n      });\n    }\n  }, {\n    key: 'unsubscribeDevice',\n    value: function unsubscribeDevice() {\n      var _this4 = this;\n\n      // Disable the switch so it can't be changed while\n      // we process permissions\n      // window.PushDemo.ui.setPushSwitchDisabled(true);\n\n      this._stateChangeCb(this._state.STARTING_UNSUBSCRIBE);\n\n      navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {\n        return serviceWorkerRegistration.pushManager.getSubscription();\n      }).then(function (pushSubscription) {\n        // Check we have everything we need to unsubscribe\n        if (!pushSubscription) {\n          _this4._stateChangeCb(_this4._state.UNSUBSCRIBED);\n          _this4._subscriptionUpdate(null);\n          return;\n        }\n\n        // TODO: Remove the device details from the server\n        // i.e. the pushSubscription.subscriptionId and\n        // pushSubscription.endpoint\n        return pushSubscription.unsubscribe().then(function (successful) {\n          if (!successful) {\n            // The unsubscribe was unsuccessful, but we can\n            // remove the subscriptionId from our server\n            // and notifications will stop\n            // This just may be in a bad state when the user returns\n            console.error('We were unable to unregister from push');\n          }\n        });\n      }).then(function () {\n        _this4._stateChangeCb(_this4._state.UNSUBSCRIBED);\n        _this4._subscriptionUpdate(null);\n      }).catch(function (err) {\n        console.error('Error thrown while revoking push notifications. ' + 'Most likely because push was never registered', err);\n      });\n    }\n  }]);\n\n  return PushClient;\n}();\n\nvar AppController = function () {\n  function AppController() {\n    var _this5 = this;\n\n    _classCallCheck(this, AppController);\n\n    // Define a different server URL here if desire.\n    this._PUSH_SERVER_URL = '';\n    this._API_KEY = 'AIzaSyBBh4ddPa96rQQNxqiq_qQj7sq1JdsNQUQ';\n\n    // This div contains the UI for CURL commands to trigger a push\n    this._sendPushOptions = document.querySelector('.js-send-push-options');\n\n    // Below this comment is code to initialise a material design lite view.\n    var toggleSwitch = document.querySelector('.js-push-toggle-switch');\n    if (toggleSwitch.classList.contains('is-upgraded')) {\n      this.ready = Promise.resolve();\n      this._uiInitialised(toggleSwitch.MaterialSwitch);\n    } else {\n      this.ready = new Promise(function (resolve) {\n        var mdlUpgradeCb = function mdlUpgradeCb() {\n          if (!toggleSwitch.classList.contains('is-upgraded')) {\n            return;\n          }\n\n          _this5._uiInitialised(toggleSwitch.MaterialSwitch);\n          document.removeEventListener(mdlUpgradeCb);\n\n          resolve();\n        };\n\n        // This is to wait for MDL initialising\n        document.addEventListener('mdl-componentupgraded', mdlUpgradeCb);\n      });\n    }\n  }\n\n  _createClass(AppController, [{\n    key: '_uiInitialised',\n    value: function _uiInitialised(toggleSwitch) {\n      var _this6 = this;\n\n      this._stateChangeListener = this._stateChangeListener.bind(this);\n      this._subscriptionUpdate = this._subscriptionUpdate.bind(this);\n\n      this._toggleSwitch = toggleSwitch;\n      this._pushClient = new PushClient(this._stateChangeListener, this._subscriptionUpdate);\n\n      document.querySelector('.js-push-toggle-switch > input').addEventListener('click', function (event) {\n        // Inverted because clicking will change the checked state by\n        // the time we get here\n        if (event.target.checked) {\n          _this6._pushClient.subscribeDevice();\n        } else {\n          _this6._pushClient.unsubscribeDevice();\n        }\n      });\n\n      if (window.location.protocol !== 'https' && window.location.hostname !== 'localhost') {\n        this.showErrorMessage('You Need to be HTTPs', 'Please check out the ' + '<a href=\"https://gauntface.github.io/simple-push-demo/\">HTTPs ' + 'version of this page here</a>');\n      }\n    }\n  }, {\n    key: 'registerServiceWorker',\n    value: function registerServiceWorker() {\n      var _this7 = this;\n\n      // Check that service workers are supported\n      if ('serviceWorker' in navigator) {\n        navigator.serviceWorker.register('./service-worker.js').catch(function () {\n          _this7.showErrorMessage('Unable to Register SW', 'Sorry this demo requires a service worker to work and it ' + 'was didn\\'t seem to install - sorry :(');\n        });\n      } else {\n        this.showErrorMessage('Service Worker Not Supported', 'Sorry this demo requires service worker support in your browser. ' + 'Please try this demo in Chrome or Firefox Nightly.');\n      }\n    }\n  }, {\n    key: '_stateChangeListener',\n    value: function _stateChangeListener(state, data) {\n      // console.log(state);\n      if (typeof state.interactive !== 'undefined') {\n        if (state.interactive) {\n          this._toggleSwitch.enable();\n        } else {\n          this._toggleSwitch.disable();\n        }\n      }\n\n      if (typeof state.pushEnabled !== 'undefined') {\n        if (state.pushEnabled) {\n          this._toggleSwitch.on();\n        } else {\n          this._toggleSwitch.off();\n        }\n      }\n\n      switch (state.id) {\n        case 'ERROR':\n          this.showErrorMessage('Ooops a Problem Occurred', data);\n          break;\n        default:\n          break;\n      }\n    }\n  }, {\n    key: '_subscriptionUpdate',\n    value: function _subscriptionUpdate(subscription) {\n      var _this8 = this;\n\n      if (!subscription) {\n        // Remove any subscription from your servers if you have\n        // set it up.\n        this._sendPushOptions.style.opacity = 0;\n        return;\n      }\n\n      var curlCommand;\n      if (subscription.endpoint.indexOf('https://android.googleapis.com/gcm/send') === 0) {\n        curlCommand = this.produceGCMProprietaryCURLCommand(subscription);\n      } else {\n        curlCommand = this.produceWebPushProtocolCURLCommand(subscription);\n      }\n\n      var curlCodeElement = document.querySelector('.js-curl-code');\n      curlCodeElement.innerHTML = curlCommand;\n\n      // Code to handle the XHR\n      var sendPushViaXHRButton = document.querySelector('.js-send-push-button');\n      sendPushViaXHRButton.addEventListener('click', function () {\n        _this8.sendPushMessage(subscription);\n      });\n\n      // Display the UI\n      this._sendPushOptions.style.opacity = 1;\n    }\n  }, {\n    key: 'sendPushMessage',\n    value: function sendPushMessage(subscription) {\n      if (subscription.endpoint.indexOf('https://android.googleapis.com/gcm/send') === 0) {\n        this.useGCMProtocol(subscription);\n      } else {\n        this.useWebPushProtocol(subscription);\n      }\n    }\n  }, {\n    key: 'useGCMProtocol',\n    value: function useGCMProtocol(subscription) {\n      var _this9 = this;\n\n      console.log('Sending XHR to GCM Protocol endpoint');\n\n      var headers = new Headers();\n      headers.append('Content-Type', 'application/json');\n      headers.append('Authorization', 'key=' + this._API_KEY);\n\n      var endpointSections = subscription.endpoint.split('/');\n      var subscriptionId = endpointSections[endpointSections.length - 1];\n\n      fetch('https://android.googleapis.com/gcm/send', {\n        method: 'post',\n        headers: headers,\n        body: JSON.stringify({\n          registration_ids: [subscriptionId] // eslint-disable-line camelcase\n        })\n      }).then(function (response) {\n        return response.json();\n      }).then(function (responseObj) {\n        if (responseObj.failure !== 0) {\n          console.log('Failed GCM response: ', responseObj);\n          throw new Error('Failed to send push message via GCM');\n        }\n      }).catch(function (err) {\n        _this9.showErrorMessage('Ooops Unable to Send a Push', err);\n      });\n    }\n  }, {\n    key: 'useWebPushProtocol',\n    value: function useWebPushProtocol(subscription) {\n      var _this10 = this;\n\n      console.log('Sending XHR to Web Push Protocol endpoint');\n\n      fetch(subscription.endpoint, {\n        method: 'post',\n        headers: {\n          TTL: '60'\n        }\n      }).then(function (response) {\n        if (response.status >= 400 && response.status < 500) {\n          console.log('Failed web push response: ', response, response.status);\n          throw new Error('Failed to send push message via web push protocol');\n        }\n      }).catch(function (err) {\n        _this10.showErrorMessage('Ooops Unable to Send a Push', err);\n      });\n    }\n  }, {\n    key: 'produceGCMProprietaryCURLCommand',\n    value: function produceGCMProprietaryCURLCommand(subscription) {\n      var curlEndpoint = 'https://android.googleapis.com/gcm/send';\n      var endpointSections = subscription.endpoint.split('/');\n      var subscriptionId = endpointSections[endpointSections.length - 1];\n      var curlCommand = 'curl --header \"Authorization: key=' + this._API_KEY + '\" --header Content-Type:\"application/json\" ' + curlEndpoint + ' -d \"{\\\\\"registration_ids\\\\\":[\\\\\"' + subscriptionId + '\\\\\"]}\"';\n      return curlCommand;\n    }\n  }, {\n    key: 'produceWebPushProtocolCURLCommand',\n    value: function produceWebPushProtocolCURLCommand(subscription) {\n      var curlEndpoint = subscription.endpoint;\n      var curlCommand = 'curl -H \"TTL: 60\" --request POST ' + curlEndpoint;\n      return curlCommand;\n    }\n  }, {\n    key: 'showErrorMessage',\n    value: function showErrorMessage(title, message) {\n      var errorContainer = document.querySelector('.js-error-message-container');\n\n      var titleElement = errorContainer.querySelector('.js-error-title');\n      var messageElement = errorContainer.querySelector('.js-error-message');\n      titleElement.textContent = title;\n      messageElement.textContent = message;\n      errorContainer.style.opacity = 1;\n\n      var pushOptionsContainer = document.querySelector('.js-send-push-options');\n      pushOptionsContainer.style.display = 'none';\n    }\n  }]);\n\n  return AppController;\n}();\n\nmodule.exports = AppController;\n\n},{}]},{},[1]);\n"],"sourceRoot":"/source/"}