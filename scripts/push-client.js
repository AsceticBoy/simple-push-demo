!function e(t,n,i){function r(a,o){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!o&&u)return u(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var h=n[a]={exports:{}};t[a][0].call(h.exports,function(e){var n=t[a][1][e];return r(n?n:e)},h,h.exports,e,t,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(t,n){var r=this;return i(this,e),this._stateChangeCb=t,this._subscriptionUpdate=n,this._state={UNSUPPORTED:{id:"UNSUPPORTED",interactive:!1,pushEnabled:!1},INITIALISING:{id:"INITIALISING",interactive:!1,pushEnabled:!1},PERMISSION_DENIED:{id:"PERMISSION_DENIED",interactive:!1,pushEnabled:!1},PERMISSION_GRANTED:{id:"PERMISSION_GRANTED",interactive:!0},PERMISSION_PROMPT:{id:"PERMISSION_PROMPT",interactive:!0,pushEnabled:!1},ERROR:{id:"ERROR",interactive:!1,pushEnabled:!1},STARTING_SUBSCRIBE:{id:"STARTING_SUBSCRIBE",interactive:!1,pushEnabled:!0},SUBSCRIBED:{id:"SUBSCRIBED",interactive:!0,pushEnabled:!0},STARTING_UNSUBSCRIBE:{id:"STARTING_UNSUBSCRIBE",interactive:!1,pushEnabled:!1},UNSUBSCRIBED:{id:"UNSUBSCRIBED",interactive:!0,pushEnabled:!1}},"serviceWorker"in navigator&&"PushManager"in window&&"showNotification"in ServiceWorkerRegistration.prototype?void navigator.serviceWorker.ready.then(function(){r._stateChangeCb(r._state.INITIALISING),r.setUpPushPermission()}):void this._stateChangeCb(this._state.UNSUPPORTED)}return r(e,[{key:"_permissionStateChange",value:function(e){switch(e){case"denied":this._stateChangeCb(this._state.PERMISSION_DENIED);break;case"granted":this._stateChangeCb(this._state.PERMISSION_GRANTED);break;case"default":this._stateChangeCb(this._state.PERMISSION_PROMPT);break;default:console.error("Unexpected permission state: ",e)}}},{key:"setUpPushPermission",value:function(){var e=this;return this._permissionStateChange(Notification.permission),navigator.serviceWorker.ready.then(function(e){return e.pushManager.getSubscription()}).then(function(t){t&&(e._stateChangeCb(e._state.SUBSCRIBED),e._subscriptionUpdate(t))})["catch"](function(t){console.log(t),e._stateChangeCb(e._state.ERROR,t)})}},{key:"subscribeDevice",value:function(){var e=this;return this._stateChangeCb(this._state.STARTING_SUBSCRIBE),new Promise(function(e,t){return"denied"===Notification.permission?t(new Error("Push messages are blocked.")):"granted"===Notification.permission?e():void("default"===Notification.permission&&Notification.requestPermission(function(n){"granted"!==n&&t(new Error("Bad permission result")),e()}))}).then(function(){return navigator.serviceWorker.ready.then(function(e){return e.pushManager.subscribe({userVisibleOnly:!0})}).then(function(t){e._stateChangeCb(e._state.SUBSCRIBED),e._subscriptionUpdate(t)})["catch"](function(t){e._stateChangeCb(e._state.ERROR,t)})})["catch"](function(){e._permissionStateChange(Notification.permission)})}},{key:"unsubscribeDevice",value:function(){var e=this;this._stateChangeCb(this._state.STARTING_UNSUBSCRIBE),navigator.serviceWorker.ready.then(function(e){return e.pushManager.getSubscription()}).then(function(t){return t?t.unsubscribe().then(function(e){e||console.error("We were unable to unregister from push")}):(e._stateChangeCb(e._state.UNSUBSCRIBED),void e._subscriptionUpdate(null))}).then(function(){e._stateChangeCb(e._state.UNSUBSCRIBED),e._subscriptionUpdate(null)})["catch"](function(e){console.error("Error thrown while revoking push notifications. Most likely because push was never registered",e)})}}]),e}();t.exports=s},{}]},{},[1]);
//# sourceMappingURL=push-client.js.map
