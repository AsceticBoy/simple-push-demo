<!doctype html>
<!--
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE
The complete set of authors may be found at http://polymer.github.io/AUTHORS
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS
-->
<html>
<head>
  <title>PolyAir</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-touch-fullscreen" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style"
        content="black-translucent" >
  <meta name="format-detection" content="telephone=no">

  <link rel="shortcut icon" href="favicon.ico">
  <link rel="icon" sizes="96x96" href="icons/icon-96.png">

  <meta name="application-name" content="PolyAir">

  <!--
  Chrome 35 has old :host behavior before :host-context addition.
  Since Chrome 35 does not have HTMLImports, we can use this as a decent signal
  to force the ShadowDOM Polyfill.
  -->
  <script>
    if (!('import' in document.createElement('link'))) {
      var Platform = {flags: {shadow: true}};
    }
  </script>

  <script src="components/platform/platform.js"></script>

  <link rel="stylesheet" href="theme.css" shim-shadowdom>

  <link rel="import" href="components/font-roboto/roboto.html">
  <link rel="import" href="components/core-icons/core-icons.html">
  <link rel="import" href="components/core-icons/av-icons.html">
  <link rel="import" href="components/core-icons/social-icons.html">
  <link rel="import" href="components/core-drawer-panel/core-drawer-panel.html">
  <link rel="import" href="components/core-scaffold/core-scaffold.html">
  <link rel="import" href="components/paper-button/paper-button.html">
  <link rel="import" href="components/paper-fab/paper-fab.html">
  <link rel="import" href="components/paper-input/paper-input.html">
  <link rel="import" href="components/paper-item/paper-item.html">
  <link rel="import" href="flight-panel.html">

  <script>
    (function() {
      "use strict";
        var log = console.log.bind(console);
        var err = console.error.bind(console);
        if (navigator.serviceWorker) {
          var swReady = function() {
            // Paper over 37<-->40 changes
            return 'ready' in navigator.serviceWorker ?
              navigator.serviceWorker.ready :
              navigator.serviceWorker.whenReady();
          }

          // Register our ServiceWorker
          navigator.serviceWorker.register("sw.js");
          swReady().then(function(sw) {
            if (!sw) {
              err("bogus SW registration, balls");
              return;
            }
            // Register for push messages
            if (navigator.push) {
              localStorage.removeItem("pushRegistrationId");
              navigator.push.register('129757602160').then(function(pushRegistration) {
                log(pushRegistration.pushRegistrationId);
                localStorage.setItem("pushRegistrationId",
                                pushRegistration.pushRegistrationId);

                var xhr = new XMLHttpRequest();
                var fd = new FormData();
                fd.append("registration", pushRegistration.pushRegistrationId);
                xhr.open("POST", "/register_for_pushes", true);
                xhr.send(fd);
              }, function(e) {
                log('Push registration failed.');
                log(e);
              });

            }
          }, err);

          window.addEventListener("message", function(e) {
            if (e.data == "sync" && Firebase) {
              Firebase.goOnline();
              try  {
                var a = document.getElementsByTagName("topeka-app")[0]
                a.shadowRoot.getElementsByTagName("topeka-leaderboard")[0].leaderboardChange();
              } catch(e) {
                err(e);
              }
            }
          });
        }

        window.addEventListener('popstate', function(e) {
          updateContent(e.state.state);
        });

        window.history.replaceState({ 'state': null }, document.title);
    })();

    var updateState = function(state) {
      window.history.pushState({ 'state': state }, document.title);
      updateContent(state);
    };

    var updateContent = function(state) {
      var content = document.getElementById('content');
      content.model = {
        state: state,
      };
    }
  </script>

</head>
<body>

  <template id='content' is="auto-binding">
    <core-scaffold id="scaffold">
      <core-header-panel navigation flex mode="seamed">
        <core-toolbar>PolyAir</core-toolbar>
        <core-menu>
          <paper-item icon="add" label="Book trip"></paper-item>
          <hr>
          <paper-item onclick="updateState('checkin');" icon="work" label="Check-in"></paper-item>
          <paper-item icon="schedule" label="Travel information"></paper-item>
          <paper-item icon="warning" label="Delays"></paper-item>
          <hr>
          <paper-item icon="settings" label="Settings"></paper-item>
          <hr>
          <paper-item icon="help" label="Help & Feedback"></paper-item>
        </core-menu>
      </core-header-panel>
      <core-toolbar tool>PolyAir</core-toolbar>
      <template bind if="{{ !state }}">
        <div>Welcome to PolyAir!<br>
          Getting you from here to there, with flair.
        </div>
        <paper-fab icon='add' class='red'></paper-fab>
      </template>
      <template bind if="{{ state == 'checkin' }}">
        <paper-input class="narrow" required label="Booking reference"></paper-input>
        <paper-input class="narrow" required label="Last name"></paper-input>
        <paper-button onclick="updateState('checkin-confirmation');" raised class="colored">Submit</paper-button>
      </template>
      <template bind if="{{ state == 'checkin-confirmation' }}">
        <flight-panel company="United Airlines"
                      flightNumber="930"
                      status="On time"
                      departCode="SFO"
                      arrivalCode="LHR"
                      departCity="San Francisco"
                      arrivalCity="London"
                      departDate="Monday, 27 October"
                      arrivalDate="Tuesday, 28 October"
                      departTime="18:05"
                      arrivalTime="11:30"
                      departTerminal="INTL"
                      departGate="G97"
                      arrivalTerminal="2"
                      arrivalGate="-">
        </flight-panel>
      </template>
    </core-scaffold>
  </template>

</body>
</html>
